# Template file for 'mesonlsp'
pkgname=mesonlsp
version=4.3.7
revision=1
_tree_sitter_meson_version=1.0.7
_tree_sitter_ini_version=848b6269f7039739aebd169fbd3d5e6e34bef661
_sha_2_version=49265c656f9b370da660531db8cc6bf0a2e110a6
_muon_version=428964c92454b8a994e224a13f8aad913271f10c
build_style=meson
configure_args="-Duse_own_tree_sitter=false -Dtests=false"
hostmakedepends="pkg-config cmake"
makedepends="tree-sitter-devel ada-devel json-c++ libcurl-devel libarchive-devel libuuid-devel
 pkgconf-devel tomlplusplus-devel libunwind-devel"
checkdepends="gtest-devel"
short_desc="Unofficial, unendorsed language server for Meson"
maintainer="meator <meator.dev@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://github.com/JCWasmx86/mesonlsp"
changelog="https://raw.githubusercontent.com/JCWasmx86/mesonlsp/refs/heads/main/CHANGELOG.md"
distfiles="https://github.com/JCWasmx86/mesonlsp/archive/refs/tags/v${version}.tar.gz
 https://github.com/JCWasmx86/tree-sitter-meson/archive/refs/tags/v${_tree_sitter_meson_version}.tar.gz
 https://github.com/JCWasmx86/tree-sitter-ini/archive/${_tree_sitter_ini_version}.tar.gz
 https://github.com/amosnier/sha-2/archive/${_sha_2_version}.tar.gz
 https://github.com/JCWasmx86/muon/archive/${_muon_version}.tar.gz"
checksum="b84b2d4060a1aa0e09161f1a30e55f1a4d007609813e284ed4b0f4f969d406fa
 c18501809e0eac0e209af2ecfe2e72b636b647dc43f85f772a5c99f36628b797
 27c5959a71893dc67341dddee68a011383352556c81f7d5e7f25accc064c44b9
 1bac850c8082adde689b03950da35ec35e140323bf23e65d12d40fd35c7eefb3
 a04eb8024977fb09d73f00b92850e3ee102a365a3ecdcc905e42b65ebb148b09"
# https://github.com/JCWasmx86/mesonlsp/issues/176
make_check=no

skip_extraction="v${_tree_sitter_meson_version}.tar.gz ${_tree_sitter_ini_version}.tar.gz
 ${_sha_2_version}.tar.gz ${_muon_version}.tar.gz"

# if [ "$XBPS_CHECK_PKGS" ]; then
# 	configure_args+=" -Dtests=true"
# fi

pre_configure() {
	configure_args+=" --cross-file=${FILESDIR}/cmake_crossfile.ini"
}

post_extract() {
	vsrcextract -C subprojects/tree-sitter-meson "v${_tree_sitter_meson_version}.tar.gz"
	vsrcextract -C subprojects/tree-sitter-ini "${_tree_sitter_ini_version}.tar.gz"
	vsrcextract -C subprojects/sha256 "${_sha_2_version}.tar.gz"
	vsrcextract -C subprojects/muon "${_muon_version}.tar.gz"
	cp subprojects/packagefiles/tree-sitter-meson/meson.build subprojects/tree-sitter-meson/
	cp subprojects/packagefiles/tree-sitter-ini/meson.build subprojects/tree-sitter-ini/
	cp subprojects/packagefiles/sha256/meson.build subprojects/sha256/
}
