# Template file for 'auto-cpufreq'
pkgname=auto-cpufreq
version=2.3.0
revision=1
build_style=python3-pep517
# auto-cpufreq is executed in post_install() to get completions, so masterdir
# needs part of $depends installed
_core_deps="python3-click python3-psutil python3-distro python3-requests python3-inotify"
hostmakedepends="python3-poetry-core $_core_deps"
depends="$_core_deps dmidecode python3-gobject gtk+3"
short_desc="Automatic CPU speed & power optimizer for Linux"
maintainer="meator <meator.dev@gmail.com>"
license="LGPL-3.0-only"
homepage="https://github.com/AdnanHodzic/auto-cpufreq"
distfiles="https://github.com/AdnanHodzic/auto-cpufreq/archive/refs/tags/v${version}.tar.gz"
checksum=dba5a29a23b209f4ab398fd355cd9214353699e59df83d3eeb001a83a659cb00

post_patch() {
	patch -Np1 < nix/patches/prevent-install-and-copy.patch
}

post_install() {
	vsconf auto-cpufreq.conf-example auto-cpufreq.conf
	vinstall scripts/auto-cpufreq-gtk.desktop 644 usr/share/applications
	vinstall images/icon.png 644 usr/share/pixmaps auto-cpufreq.png
	vinstall scripts/style.css 644 usr/share/auto-cpufreq/scripts
	vbin scripts/cpufreqctl.sh cpufreqctl.auto-cpufreq
	vinstall scripts/org.auto-cpufreq.pkexec.policy 644 usr/share/polkit-1/actions
	vdoc ${FILESDIR}/README.voidlinux
	vsv auto-cpufreq

	for completion in bash fish zsh; do
		PYTHONPATH=$DESTDIR/$py3_sitelib _AUTO_CPUFREQ_COMPLETE=${completion}_source ${DESTDIR}/usr/bin/auto-cpufreq > auto-cpufreq.$completion
		vcompletion auto-cpufreq.$completion $completion
	done
}
